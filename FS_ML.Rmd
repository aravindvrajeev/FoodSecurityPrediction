---
title: "Predicating Food Insecurity in Sub-Saharan Africa with Machine Learning"
author: Yujun Zhou
date: April 13, 2018
fontsize: 30pt
font: arial
output:
  beamer_presentation: default
  ioslides_presentation: default
  slidy_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Research Question

- Can we build an early warning system of food security in areas where data is scarce and data collection is costly ? (Hutchinson,1991)
    + Timely and accurate targeting is essential for aid and humanitarian responses 
    
- How to make use of publicly available and economically meaningful data? 
    + Price data of the main agricultural markets are collected monthly or weekly 
    + Precipitation/temperature/soil quality from satellite imagery are relevant to agricultural production 
   
 -  Find the supervised learning approach that has higher predicative power but remain interpretable.

## Preview of Results

  - Out-of-sample predictions from our model explains 50%-67% of cluster level variations in Malawi.  
  
  - Using the same sets of features, a tuned machine learning model outperforms a baseline linear model by 20 - 30% in high dimensional settings. 
  
  - Validates the "A Prototype for Predicting Food Insecurity Using Readily Available Data" paper with three countries and seven years of training data.

    
## Literature Review

  - Night lights data (Chen and Nordhaus 2011;Henderson et al. 2012.) does a good job at predicating economic activity but the variation is little in areas of the extreme poor or in urban areas. 
  
  - Mobile phone data (Blumenstock et al.,2015; Steele et al.,2017) is useful but expensive.
  
  - High resolution satellite imagery are becoming cheaper but highly unstructured and contains measurement error (Jean et al., 2016; Donaldson and Storeygard, 2016). 
  
  - Convolutional Neural Network (CNN) models (Jean et al., 2016; Babenko et al. 2017) can explain an average of 46% of the variation at village level but they require an enormous amount of training data and are computational extensive. Interpret-ability and repeat-ability are not that promising (Engstrom,2018).
   
## Framework

- Understanding of the food security. The definition of food security has various characteristics. The use metrics can lead to quite divergent rankings of the same population (Steele et al. 2017)

- Geo-referenced household surveys (LSMS data) allow us to explore the spatial-temporal variations in food security measures.

- The sampling framework in these surveys made it possible for us to observe a nationally representative sample in different months and agroecological zones. 

- Explain these variations by the spatial-temporal variation in food availability and in food access.
    + Align weather data to crop growing season 
    + Align households to the most relevant market price

- Utilize the interaction and higher order terms of the variables



## Temporal Variation

```{r out.width = "65%", fig.align = "center"}
knitr::include_graphics(c("output/graphs/fsbymonth_malawi.pdf","output/graphs/seasonal-calendar-malawi.png"))
```


## Temporal Variation

```{r out.width = "65%", fig.align = "center"}
knitr::include_graphics(c("output/graphs/fsbymonth_uganda.pdf","output/graphs/seasonal-calendar-uganda.png"))
```

## Spatio-temporal variation

![Food Security Maps in Tanzania, January ](output\graphs\fsmaps_jan.pdf)


## Spatialtemporal variation

![Food Security Maps in Tanzania, August ](output\graphs\fsmaps_august.pdf)

## Data
 
 - Price data (maize and cassava)
 
 - Weather 
     + first day of rainfall
     + rainfall in growing season
     + maximum of days without rain 
     + mean temperature
     + growing degree days (days that average temperature between 5-32 Degree Celsius)
   
 - Soil quality: slope, water, soil nutrition 
 
 - Roof/floor type, household asset index
 
 
## Modelling strategy
 
 -  Set of models deal with high dimensional problem with different types regularization:
    + Lasso (L1 norm, prefers smaller model)
    + Ridge (L2 norm, prefers large model)
    + Elastic Net (Combination of the two)
 
 - Set of models that are great with positively skewed and high dimensional data: 
    + Random Forest 
    + Gradient boosting 

## Main Results
```{r,echo=FALSE}
result = read.csv(file = "output/table/cluster_result.csv")
```

```{r}
knitr::kable(na.omit(result),caption = "Cluster Level prediction R squares")
```



## Scatter Plots 
 - FCS
 
```{r,echo=FALSE}
fcspair= read.csv("output/graphs/FCSsplot.csv")
library(ggplot2)
ggplot(as.data.frame(fcspair), aes(clust_logFCS, pred )) +
  geom_point(shape = 16, size = 3, show.legend = FALSE,na.rm = TRUE) +
  theme_minimal() + geom_abline(intercept = 0, slope = 1)+
  scale_color_brewer(palette="Dark2") +
  annotate(geom = "text", size = 5, x = 4.28, y = 3.75, label = paste("R Squares = ",0.577,sep = " ")) +
  labs(x = "Cluster Average logFCS (Actual)", y = "Cluster Average logFCS (Predicted)")


```



## Scatter plots
 - HDDS

```{r,echo=FALSE}
HDDS_pair= read.csv("output/graphs/hddsplot.csv")
ggplot(as.data.frame(HDDS_pair), aes(clust_HDDS, pred)) +
  geom_point(shape = 16, size = 3, show.legend = FALSE,na.rm = TRUE) +
  theme_minimal() + geom_abline(intercept = 0, slope = 1)+
  scale_color_brewer(palette="Dark2")+
  annotate(geom = "text", size = 5, x = 6.5, y = 4.5, label = paste("R Squares = ",0.686,sep = " "))+
  labs(x = "Cluster Average HDDS (Actual)", y = "Cluster Average HDDS (Predicted)")
```


## Scatter plots
 - RCSI

```{r,echo=FALSE}
rcsi_pair= read.csv("output/graphs/rcsi.csv")
ggplot(as.data.frame(rcsi_pair), aes(actual, pred)) +
  geom_point(shape = 16, size = 3, show.legend = FALSE,na.rm = TRUE) +
  theme_minimal() + geom_abline(intercept = 0, slope = 1)+
  scale_color_brewer(palette="Dark2") +
  annotate(geom = "text", size = 5, x = 3, y = 0.6 , label = paste("R Squares = ",0.123,sep = " ")) +
  labs(x = "Cluster Average RCSI (Actual)", y = "Cluster Average RCSI (Predicted)")
```

## Future Steps 
 - Vary the time gap between training and testing ( train and test on the a subset of data that are only several weeks/month apart)
 - Trained on a pooled data set across different countries V.S. Fit models on each individual country with the same procedure
 - Predict "now": countries/areas that are not surveyed and suggest areas that are likely to have a food shortage. 
 
### Limitations 
 - limited to gradual food insecure cases and can't predict sudden, abrupt threat to food security (natural disaster, war and conflict) 
 
 
